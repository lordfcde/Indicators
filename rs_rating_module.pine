//@version=6
// ==========================================
// üìä RS RATING MODULE (IBD STYLE) - PLUG & PLAY
// ==========================================
// Module ƒë·ªôc l·∫≠p ƒë·ªÉ t√≠nh v√† hi·ªÉn th·ªã RS Rating theo ph∆∞∆°ng ph√°p William O'Neil
// Paste ƒëo·∫°n code n√†y v√†o cu·ªëi indicator hi·ªán t·∫°i c·ªßa b·∫°n

// ==========================================
// 1. SETTINGS (C·∫•u h√¨nh)
// ==========================================
grp_rs = "üìä RS Rating (IBD)"
i_showRS = input.bool(true, "Hi·ªán RS Rating", group=grp_rs)
i_benchmark = input.symbol("VN:VNINDEX", "Benchmark Index", group=grp_rs, tooltip="M√£ ch·ªâ s·ªë ƒë·ªÉ so s√°nh (m·∫∑c ƒë·ªãnh VNINDEX)")
i_rsPosition = input.string("Bottom Left", "V·ªã tr√≠ Dashboard", options=["Top Left", "Top Right", "Bottom Left", "Bottom Right"], group=grp_rs)

// ==========================================
// 2. T√çNH TO√ÅN HI·ªÜU SU·∫§T (PERFORMANCE)
// ==========================================

// L·∫•y d·ªØ li·ªáu gi√° ƒë√≥ng c·ª≠a c·ªßa Benchmark
benchmarkClose = request.security(i_benchmark, timeframe.period, close)

// H√†m t√≠nh % thay ƒë·ªïi gi√°
calcPerformance(lookback) =>
    if bar_index >= lookback
        currentPrice = close
        pastPrice = close[lookback]
        pastPrice != 0 ? ((currentPrice - pastPrice) / pastPrice) * 100 : 0
    else
        0

calcBenchmarkPerf(lookback) =>
    if bar_index >= lookback
        currentBench = benchmarkClose
        pastBench = benchmarkClose[lookback]
        pastBench != 0 ? ((currentBench - pastBench) / pastBench) * 100 : 0
    else
        0

// T√≠nh hi·ªáu su·∫•t theo c√°c kho·∫£ng th·ªùi gian (IBD Weighted)
perf_3m_stock = calcPerformance(63)    // 3 th√°ng (63 phi√™n giao d·ªãch)
perf_6m_stock = calcPerformance(126)   // 6 th√°ng
perf_9m_stock = calcPerformance(189)   // 9 th√°ng
perf_12m_stock = calcPerformance(252)  // 1 nƒÉm

perf_3m_bench = calcBenchmarkPerf(63)
perf_6m_bench = calcBenchmarkPerf(126)
perf_9m_bench = calcBenchmarkPerf(189)
perf_12m_bench = calcBenchmarkPerf(252)

// ==========================================
// 3. T√çNH RS SCORE (WEIGHTED)
// ==========================================

// Tr·ªçng s·ªë IBD: 3m=40%, 6m=20%, 9m=20%, 12m=20%
weight_3m = 0.40
weight_6m = 0.20
weight_9m = 0.20
weight_12m = 0.20

// T√≠nh ƒëi·ªÉm tr·ªçng s·ªë
stock_weighted = (perf_3m_stock * weight_3m) + (perf_6m_stock * weight_6m) + 
                 (perf_9m_stock * weight_9m) + (perf_12m_stock * weight_12m)

bench_weighted = (perf_3m_bench * weight_3m) + (perf_6m_bench * weight_6m) + 
                 (perf_9m_bench * weight_9m) + (perf_12m_bench * weight_12m)

// T√≠nh RS Score (Relative Strength)
// C√¥ng th·ª©c proxy: So s√°nh hi·ªáu su·∫•t c·ªï phi·∫øu vs benchmark
// Quy v·ªÅ thang ƒëi·ªÉm 1-99
rs_diff = stock_weighted - bench_weighted

// Normalize v·ªÅ thang 1-99 (50 l√† trung b√¨nh th·ªã tr∆∞·ªùng)
// Gi·∫£ ƒë·ªãnh: +50% outperform = RS 90, -50% underperform = RS 10
rs_raw = 50 + (rs_diff * 0.8) // Scale factor 0.8 ƒë·ªÉ ƒëi·ªÅu ch·ªânh ƒë·ªô nh·∫°y

// Gi·ªõi h·∫°n 1-99
rs_rating = rs_raw > 99 ? 99 : rs_raw < 1 ? 1 : math.round(rs_raw)

// ==========================================
// 4. HI·ªÇN TH·ªä DASHBOARD (MINI TABLE)
// ==========================================

// X√°c ƒë·ªãnh v·ªã tr√≠ b·∫£ng
table_position = i_rsPosition == "Top Left" ? position.top_left : 
                 i_rsPosition == "Top Right" ? position.top_right : 
                 i_rsPosition == "Bottom Left" ? position.bottom_left : 
                 position.bottom_right

// T·∫°o b·∫£ng RS Rating
var table rs_panel = table.new(table_position, 2, 1, border_width=2, force_overlay=true)

if barstate.islast and i_showRS
    // X√°c ƒë·ªãnh m√†u s·∫Øc d·ª±a tr√™n RS Rating
    rs_color = rs_rating > 90 ? #9C27B0 :  // T√≠m - Si√™u m·∫°nh (>90)
               rs_rating >= 80 ? color.new(color.green, 0) :  // Xanh l√° - Leader (80-90)
               rs_rating >= 60 ? color.orange :  // Cam - Trung b√¨nh (60-80)
               color.red  // ƒê·ªè - Y·∫øu (<60)
    
    rs_category = rs_rating > 90 ? "SI√äU M·∫†NH üî•" :
                  rs_rating >= 80 ? "LEADER üí™" :
                  rs_rating >= 60 ? "TRUNG B√åNH ‚ö†Ô∏è" :
                  "Y·∫æU üìâ"
    
    // Hi·ªÉn th·ªã b·∫£ng
    table.cell(rs_panel, 0, 0, "RS RATING", bgcolor=color.new(color.black, 0), text_color=color.white, text_size=size.small)
    table.cell(rs_panel, 1, 0, str.tostring(rs_rating) + "\n" + rs_category, 
               bgcolor=color.new(color.black, 20), 
               text_color=rs_color, 
               text_size=size.normal)

// ==========================================
// 5. PLOT RS LINE (OPTIONAL - T·∫ÆT M·∫∂C ƒê·ªäNH)
// ==========================================
// N·∫øu mu·ªën xem ƒë∆∞·ªùng RS theo th·ªùi gian, uncomment d√≤ng d∆∞·ªõi:
// plot(rs_rating, "RS Rating", color=color.new(color.purple, 0), linewidth=2)
