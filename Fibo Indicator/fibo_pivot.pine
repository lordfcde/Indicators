//@version=6
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê //
//# * Simplified Fibonacci Pivot Points
//# * Author: ¬© Vinh
//# * Features: Auto HTF, Pivot Points with Custom Levels & Colors
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê //

indicator('Fibo Pivot Points', 'FIB PP', true, max_lines_count = 50, max_labels_count = 50)

// ==========================================
// SETTINGS
// ==========================================
group_pp = 'üìä Pivot Points'

i_showLabels = input.bool(true, 'Hi·ªán Labels v·ªõi Gi√°', group = group_pp)
i_extend = input.bool(false, 'M·ªü r·ªông ƒë∆∞·ªùng Pivot', group = group_pp)

// Fibonacci Levels - User c√≥ th·ªÉ t√πy ch·ªânh t·ª´ng level
group_levels = 'üé® Fibonacci Levels'

show_pp = input.bool(true, 'PP (Pivot Point)', inline = 'pp', group = group_levels)
color_pp = input.color(#888888, '', inline = 'pp', group = group_levels)

show_s1 = input.bool(true, 'S1 (Support 1)', inline = 's1', group = group_levels)
level_s1 = input.float(0.382, '', inline = 's1', group = group_levels)
color_s1 = input.color(#4CAF50, '', inline = 's1', group = group_levels)

show_r1 = input.bool(true, 'R1 (Resistance 1)', inline = 'r1', group = group_levels)
level_r1 = input.float(0.382, '', inline = 'r1', group = group_levels)
color_r1 = input.color(#F44336, '', inline = 'r1', group = group_levels)

show_s2 = input.bool(true, 'S2 (Support 2)', inline = 's2', group = group_levels)
level_s2 = input.float(0.618, '', inline = 's2', group = group_levels)
color_s2 = input.color(#00BCD4, '', inline = 's2', group = group_levels)

show_r2 = input.bool(true, 'R2 (Resistance 2)', inline = 'r2', group = group_levels)
level_r2 = input.float(0.618, '', inline = 'r2', group = group_levels)
color_r2 = input.color(#FF5722, '', inline = 'r2', group = group_levels)

show_s3 = input.bool(true, 'S3 (Support 3)', inline = 's3', group = group_levels)
level_s3 = input.float(1.0, '', inline = 's3', group = group_levels)
color_s3 = input.color(#2196F3, '', inline = 's3', group = group_levels)

show_r3 = input.bool(true, 'R3 (Resistance 3)', inline = 'r3', group = group_levels)
level_r3 = input.float(1.0, '', inline = 'r3', group = group_levels)
color_r3 = input.color(#E91E63, '', inline = 'r3', group = group_levels)

// ==========================================
// AUTO TIMEFRAME DETECTION (Tr√°nh tr√πng l·∫∑p)
// ==========================================
htf = 
     timeframe.period == '1' or timeframe.period == '3' or timeframe.period == '5' ? 'D' :
     timeframe.period == '15' or timeframe.period == '30' ? 'D' :
     timeframe.period == '60' or timeframe.period == '120' or timeframe.period == '240' ? 'W' :
     timeframe.period == 'D' ? 'M' :
     timeframe.period == 'W' ? '3M' :
     timeframe.period == 'M' ? '12M' :
     'W'

// ==========================================
// HTF OHLC CALCULATION
// ==========================================
[htf_h, htf_l, htf_c] = request.security(syminfo.tickerid, htf, [high[1], low[1], close[1]], lookahead = barmerge.lookahead_on)

// ==========================================
// PIVOT POINT CALCULATIONS
// ==========================================
pivot = (htf_h + htf_l + htf_c) / 3
range_pp = htf_h - htf_l

// Support & Resistance levels v·ªõi t·ªâ l·ªá t√πy ch·ªânh
s1 = pivot - range_pp * level_s1
r1 = pivot + range_pp * level_r1
s2 = pivot - range_pp * level_s2
r2 = pivot + range_pp * level_r2
s3 = pivot - range_pp * level_s3
r3 = pivot + range_pp * level_r3

// ==========================================
// DRAWING
// ==========================================
f_label(_price, _name, _color) =>
    if i_showLabels
        _name + ' (' + str.tostring(_price, format.mintick) + ')'
    else
        _name

// Plot lines - m·ªói level m·ªôt plot ri√™ng bi·ªát
plot(show_pp ? pivot : na, 'PP', color_pp, 2, plot.style_line)
plot(show_s1 ? s1 : na, 'S1', color_s1, 2, plot.style_line)
plot(show_r1 ? r1 : na, 'R1', color_r1, 2, plot.style_line)
plot(show_s2 ? s2 : na, 'S2', color_s2, 2, plot.style_line)
plot(show_r2 ? r2 : na, 'R2', color_r2, 2, plot.style_line)
plot(show_s3 ? s3 : na, 'S3', color_s3, 2, plot.style_line)
plot(show_r3 ? r3 : na, 'R3', color_r3, 2, plot.style_line)

// Labels ·ªü cu·ªëi (ch·ªâ v·∫Ω 1 l·∫ßn tr√™n bar cu·ªëi)
if barstate.islast and i_showLabels
    if show_pp
        label.new(bar_index + 5, pivot, f_label(pivot, 'PP', color_pp), xloc.bar_index, yloc.price, color.new(color.white, 100), label.style_label_left, color_pp, size.small)
    if show_s1
        label.new(bar_index + 5, s1, f_label(s1, 'S1', color_s1), xloc.bar_index, yloc.price, color.new(color.white, 100), label.style_label_left, color_s1, size.small)
    if show_r1
        label.new(bar_index + 5, r1, f_label(r1, 'R1', color_r1), xloc.bar_index, yloc.price, color.new(color.white, 100), label.style_label_left, color_r1, size.small)
    if show_s2
        label.new(bar_index + 5, s2, f_label(s2, 'S2', color_s2), xloc.bar_index, yloc.price, color.new(color.white, 100), label.style_label_left, color_s2, size.small)
    if show_r2
        label.new(bar_index + 5, r2, f_label(r2, 'R2', color_r2), xloc.bar_index, yloc.price, color.new(color.white, 100), label.style_label_left, color_r2, size.small)
    if show_s3
        label.new(bar_index + 5, s3, f_label(s3, 'S3', color_s3), xloc.bar_index, yloc.price, color.new(color.white, 100), label.style_label_left, color_s3, size.small)
    if show_r3
        label.new(bar_index + 5, r3, f_label(r3, 'R3', color_r3), xloc.bar_index, yloc.price, color.new(color.white, 100), label.style_label_left, color_r3, size.small)

// ==========================================
// ALERTS
// ==========================================
f_crossing(_level) => ta.cross(close, _level)

alertcondition(f_crossing(pivot), 'Cross PP', 'Gi√° c·∫Øt Pivot Point')
alertcondition(f_crossing(s1), 'Cross S1', 'Gi√° c·∫Øt Support 1')
alertcondition(f_crossing(r1), 'Cross R1', 'Gi√° c·∫Øt Resistance 1')
alertcondition(f_crossing(s2), 'Cross S2', 'Gi√° c·∫Øt Support 2')
alertcondition(f_crossing(r2), 'Cross R2', 'Gi√° c·∫Øt Resistance 2')
